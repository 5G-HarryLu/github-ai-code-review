name: Test AI Code Review Action

# 測試本地的 GitHub Action
on:
  pull_request:
    types: [opened, synchronize]
    paths:
      - 'src/**'
      - 'ai-code-reviewer.js'
      - 'action.yml'
      - '.github/workflows/test-action.yml'

jobs:
  test-action:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # 測試本地的 Action（使用相對路徑）
      - name: Test AI Code Review Action
        id: review
        uses: ./
        with:
          gemini-api-key: ${{ secrets.GEMINI_API_KEY }}
          github-token: ${{ secrets.GITHUB_TOKEN }}

      # 驗證輸出
      - name: Verify outputs
        if: always()
        run: |
          echo "Review posted: ${{ steps.review.outputs.review-posted }}"
          echo "Comment URL: ${{ steps.review.outputs.comment-url }}"

      # 如果審查失敗，標記為警告（不阻止 PR）
      - name: Handle review failure
        if: failure()
        run: |
          echo "::warning::AI Code Review failed, but not blocking PR"
