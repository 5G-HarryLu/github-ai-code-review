# ğŸ”§ æ•…éšœæ’é™¤æŒ‡å—

## å•é¡Œï¼šGemini API æŒçºŒå¤±æ•—

å¦‚æœä½ é‡åˆ° Gemini API éŒ¯èª¤ï¼Œè«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿè¨ºæ–·å’Œè§£æ±ºã€‚

---

## ğŸš€ å¿«é€Ÿè¨ºæ–·å·¥å…·

æˆ‘å€‘æä¾›äº†ä¸€å€‹è¨ºæ–·å·¥å…·ä¾†æ¸¬è©¦ä½ çš„ API key å’Œå¯ç”¨çš„æ¨¡å‹ã€‚

### é‹è¡Œè¨ºæ–·

```bash
# è¨­ç½® API key
export GEMINI_API_KEY="your-api-key-here"

# é‹è¡Œè¨ºæ–·å·¥å…·
npm run test:gemini
```

### è¨ºæ–·å·¥å…·æœƒåšä»€éº¼ï¼Ÿ

1. âœ… é©—è­‰ API key æ ¼å¼
2. âœ… æ¸¬è©¦æ‰€æœ‰å¯ç”¨çš„ Gemini æ¨¡å‹
3. âœ… é¡¯ç¤ºæ¯å€‹æ¨¡å‹çš„éŸ¿æ‡‰æ™‚é–“
4. âœ… æ¨è–¦æœ€å¿«çš„å¯ç”¨æ¨¡å‹
5. âœ… æä¾›è©³ç´°çš„éŒ¯èª¤è¨ºæ–·

---

## ğŸ“‹ å¸¸è¦‹éŒ¯èª¤å’Œè§£æ±ºæ–¹æ¡ˆ

### éŒ¯èª¤ 1: 429 Too Many Requests (é…é¡é™åˆ¶)

**ç—‡ç‹€**ï¼š
```
[429 Too Many Requests] You exceeded your current quota
```

**åŸå› **ï¼š
- è¶…éå…è²»é…é¡é™åˆ¶
- å…è²»é…é¡ï¼šæ¯å¤© 1500 æ¬¡ï¼Œæ¯åˆ†é˜ 15 æ¬¡

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

1. **ç­‰å¾…é…é¡é‡ç½®**
   - æ¯åˆ†é˜é™åˆ¶ï¼šç­‰å¾… 1 åˆ†é˜
   - æ¯æ—¥é™åˆ¶ï¼šç­‰å¾…åˆ°æ¬¡æ—¥ï¼ˆUTC æ™‚å€ï¼‰

2. **æª¢æŸ¥ä½¿ç”¨é‡**
   ```
   https://aistudio.google.com/app/apikey
   ```

3. **ä½¿ç”¨æ¨¡å‹é™ç´š** â­
   - ä»£ç¢¼å·²è‡ªå‹•å¯¦ç¾æ¨¡å‹é™ç´š
   - æœƒè‡ªå‹•å˜—è©¦ï¼šthinking-exp â†’ pro â†’ flash

4. **å‡ç´šåˆ°ä»˜è²»è¨ˆåŠƒ**
   - å‰å¾€ï¼šhttps://ai.google.dev/pricing
   - ä»˜è²»è¨ˆåŠƒé…é¡æ›´é«˜

---

### éŒ¯èª¤ 2: 403/401 API Key éŒ¯èª¤

**ç—‡ç‹€**ï¼š
```
[403 Forbidden] API key not valid
[401 Unauthorized] The request is missing a valid API key
```

**åŸå› **ï¼š
- API key ç„¡æ•ˆæˆ–æ ¼å¼éŒ¯èª¤
- API key å·²è¢«æ’¤éŠ·
- API æœªå•Ÿç”¨

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

1. **é©—è­‰ API Key æ ¼å¼**
   - æ­£ç¢ºæ ¼å¼ï¼š`AIzaSy...`ï¼ˆç´„ 39 å­—ç¬¦ï¼‰
   - å¿…é ˆä»¥ `AIza` é–‹é ­

2. **é‡æ–°å‰µå»º API Key**
   ```
   https://aistudio.google.com/app/apikey
   ```
   - åˆªé™¤èˆŠçš„ key
   - å‰µå»ºæ–°çš„ key
   - æ›´æ–° GitHub Secret

3. **ç¢ºèª Gemini API å·²å•Ÿç”¨**
   - å‰å¾€ Google Cloud Console
   - å•Ÿç”¨ "Generative Language API"

---

### éŒ¯èª¤ 3: 404 Model Not Found

**ç—‡ç‹€**ï¼š
```
[404 Not Found] models/gemini-2.5-pro is not found
```

**åŸå› **ï¼š
- æ¨¡å‹åç¨±éŒ¯èª¤
- æ¨¡å‹å·²è¢«ç§»é™¤æˆ–æ›´å
- å€åŸŸä¸æ”¯æŒè©²æ¨¡å‹

**ç•¶å‰å¯ç”¨æ¨¡å‹**ï¼ˆæˆªè‡³ 2025-01ï¼‰ï¼š
- âœ… `gemini-2.0-flash-thinking-exp` - æœ€æ–°æ€è€ƒæ¨¡å‹ï¼ˆå¯¦é©—ï¼‰
- âœ… `gemini-2.0-flash-exp` - Gemini 2.0 Flashï¼ˆå¯¦é©—ï¼‰
- âœ… `gemini-1.5-pro` - Pro æ¨¡å‹ï¼ˆç©©å®šï¼‰â­
- âœ… `gemini-1.5-flash` - Flash æ¨¡å‹ï¼ˆç©©å®šï¼Œæ¨è–¦ï¼‰â­
- âœ… `gemini-1.5-flash-8b` - è¼•é‡ç‰ˆ

**âŒ ä¸å­˜åœ¨çš„æ¨¡å‹**ï¼š
- âŒ `gemini-2.5-pro` - æ­¤æ¨¡å‹ä¸å­˜åœ¨
- âŒ `gemini-pro` - å·²æ£„ç”¨ï¼Œä½¿ç”¨ gemini-1.5-pro

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

1. **é‹è¡Œè¨ºæ–·å·¥å…·ç¢ºèªå¯ç”¨æ¨¡å‹**
   ```bash
   npm run test:gemini
   ```

2. **ä½¿ç”¨æ¨è–¦æ¨¡å‹**
   ```yaml
   gemini-model: gemini-1.5-pro  # ç©©å®šä¸”å¼·å¤§
   # æˆ–
   gemini-model: gemini-1.5-flash  # é€Ÿåº¦æœ€å¿«
   ```

3. **è®“ä»£ç¢¼è‡ªå‹•é™ç´š**
   - å·²å¯¦ç¾è‡ªå‹•æ¨¡å‹é™ç´š
   - æœƒå˜—è©¦å¤šå€‹æ¨¡å‹ç›´åˆ°æˆåŠŸ

---

### éŒ¯èª¤ 4: Network/Connection Error

**ç—‡ç‹€**ï¼š
```
Error fetching from https://generativelanguage.googleapis.com/...
Connection timeout
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

1. **æª¢æŸ¥ç¶²çµ¡é€£æ¥**
   ```bash
   ping generativelanguage.googleapis.com
   ```

2. **æª¢æŸ¥é˜²ç«ç‰†è¨­ç½®**
   - ç¢ºä¿å¯ä»¥è¨ªå• `*.googleapis.com`

3. **æª¢æŸ¥ GitHub Actions ç¶²çµ¡**
   - GitHub Actions åœ¨æŸäº›å€åŸŸå¯èƒ½å—é™
   - è€ƒæ…®ä½¿ç”¨ VPN æˆ–ä»£ç†

---

## ğŸ¯ æ¨è–¦é…ç½®

### æœ€ç©©å®šé…ç½®ï¼ˆæ¨è–¦ï¼‰

```yaml
- uses: 5G-HarryLu/github-ai-code-review@v1
  with:
    gemini-api-key: ${{ secrets.GEMINI_API_KEY }}
    gemini-model: gemini-1.5-pro  # ç©©å®šä¸”å¼·å¤§
```

**å„ªé»**ï¼š
- âœ… ç©©å®šå¯é 
- âœ… é…é¡å……è¶³
- âœ… åˆ†ææ·±å…¥
- âœ… æ­£å¼ç™¼å¸ƒç‰ˆæœ¬

### æœ€å¿«é€Ÿåº¦é…ç½®

```yaml
- uses: 5G-HarryLu/github-ai-code-review@v1
  with:
    gemini-api-key: ${{ secrets.GEMINI_API_KEY }}
    gemini-model: gemini-1.5-flash  # é€Ÿåº¦æœ€å¿«
```

**å„ªé»**ï¼š
- âœ… éŸ¿æ‡‰æœ€å¿«ï¼ˆ< 3 ç§’ï¼‰
- âœ… é…é¡æœ€å„ª
- âœ… æˆæœ¬æœ€ä½

### å¯¦é©—æ€§é…ç½®ï¼ˆä¸æ¨è–¦ç”Ÿç”¢ï¼‰

```yaml
- uses: 5G-HarryLu/github-ai-code-review@v1
  with:
    gemini-api-key: ${{ secrets.GEMINI_API_KEY }}
    gemini-model: gemini-2.0-flash-thinking-exp  # å¯¦é©—æ€§
```

**æ³¨æ„**ï¼š
- âš ï¸ å¯¦é©—æ€§æ¨¡å‹
- âš ï¸ é…é¡ä¸ç©©å®š
- âš ï¸ å¯èƒ½éš¨æ™‚è®Šæ›´

---

## ğŸ” è¨ºæ–·æª¢æŸ¥æ¸…å–®

åœ¨æäº¤ Issue å‰ï¼Œè«‹å®Œæˆä»¥ä¸‹æª¢æŸ¥ï¼š

- [ ] é‹è¡Œ `npm run test:gemini` è¨ºæ–·å·¥å…·
- [ ] ç¢ºèª API key æ ¼å¼æ­£ç¢ºï¼ˆä»¥ `AIza` é–‹é ­ï¼‰
- [ ] æª¢æŸ¥ API key åœ¨ Google AI Studio ä¸­æœ‰æ•ˆ
- [ ] ç¢ºèªæ²’æœ‰è¶…éé…é¡é™åˆ¶
- [ ] å˜—è©¦ä¸åŒçš„æ¨¡å‹ï¼ˆproã€flashï¼‰
- [ ] æŸ¥çœ‹ GitHub Actions æ—¥èªŒä¸­çš„è©³ç´°éŒ¯èª¤

---

## ğŸ’¡ æœ€ä½³å¯¦è¸

### 1. é¸æ“‡æ­£ç¢ºçš„æ¨¡å‹

| éœ€æ±‚ | æ¨è–¦æ¨¡å‹ | åŸå›  |
|------|---------|------|
| æ—¥å¸¸ PR å¯©æŸ¥ | `gemini-1.5-flash` | é€Ÿåº¦å¿«ã€é…é¡å„ª |
| è¤‡é›œä»£ç¢¼å¯©æŸ¥ | `gemini-1.5-pro` | åˆ†ææ·±å…¥ |
| å¯¦é©—æ–°åŠŸèƒ½ | `gemini-2.0-flash-thinking-exp` | æœ€æ–°èƒ½åŠ› |

### 2. ç®¡ç†é…é¡

- é™åˆ¶ workflow è§¸ç™¼æ¢ä»¶ï¼ˆåªå¯©æŸ¥é‡è¦åˆ†æ”¯ï¼‰
- ä½¿ç”¨ `paths` éæ¿¾å™¨ï¼ˆåªå¯©æŸ¥ç‰¹å®šæ–‡ä»¶ï¼‰
- è€ƒæ…®å‡ç´šåˆ°ä»˜è²»è¨ˆåŠƒï¼ˆå¤§å‹åœ˜éšŠï¼‰

### 3. éŒ¯èª¤è™•ç†

- ä»£ç¢¼å·²å¯¦ç¾è‡ªå‹•é‡è©¦å’Œæ¨¡å‹é™ç´š
- ç„¡éœ€æ‰‹å‹•è™•ç†å¤§éƒ¨åˆ†éŒ¯èª¤
- é—œæ³¨ Actions æ—¥èªŒä¸­çš„è¨ºæ–·ä¿¡æ¯

---

## ğŸ“ ç²å–å¹«åŠ©

å¦‚æœä»¥ä¸Šæ­¥é©Ÿéƒ½ç„¡æ³•è§£æ±ºå•é¡Œï¼š

1. **æŸ¥çœ‹ GitHub Actions æ—¥èªŒ**
   - è¤‡è£½å®Œæ•´çš„éŒ¯èª¤è¨Šæ¯

2. **é‹è¡Œè¨ºæ–·å·¥å…·**
   ```bash
   npm run test:gemini
   ```
   - è¤‡è£½è¨ºæ–·çµæœ

3. **æäº¤ Issue**
   - å‰å¾€ï¼šhttps://github.com/5G-HarryLu/github-ai-code-review/issues
   - æä¾›ï¼šéŒ¯èª¤è¨Šæ¯ã€è¨ºæ–·çµæœã€é…ç½®ä¿¡æ¯

4. **æª¢æŸ¥ Gemini API ç‹€æ…‹**
   - https://status.cloud.google.com/

---

## ğŸ”— æœ‰ç”¨çš„é€£çµ

- [Google AI Studio](https://aistudio.google.com/app/apikey) - ç®¡ç† API key
- [Gemini API æ–‡æª”](https://ai.google.dev/docs) - å®˜æ–¹æ–‡æª”
- [é…é¡å’Œé™åˆ¶](https://ai.google.dev/gemini-api/docs/rate-limits) - é…é¡èªªæ˜
- [å®šåƒ¹è³‡è¨Š](https://ai.google.dev/pricing) - å…è²»å’Œä»˜è²»è¨ˆåŠƒ
- [æ¨¡å‹åˆ—è¡¨](https://ai.google.dev/gemini-api/docs/models) - æ‰€æœ‰å¯ç”¨æ¨¡å‹

---

**æœ€å¾Œæ›´æ–°**: 2025-01-19

**Note**: `gemini-2.5-pro` æ¨¡å‹ä¸å­˜åœ¨ã€‚è«‹ä½¿ç”¨ `gemini-1.5-pro` æˆ–é‹è¡Œè¨ºæ–·å·¥å…·æŸ¥çœ‹å¯ç”¨æ¨¡å‹ã€‚
